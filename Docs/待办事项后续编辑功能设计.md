# 待办事项后续编辑功能设计文档

## 1. 功能概述

传统的待办事项应用通常只提供简单的创建和勾选完成功能，缺乏对任务生命周期的全面管理。本文档旨在设计一套完整的待办事项后续编辑功能，让用户能够对任务进行更深入的管理和跟踪。

## 2. 现有问题分析

### 2.1 传统待办事项的局限性
- **功能单一**：只能创建和标记完成
- **缺乏过程记录**：无法记录任务执行过程中的细节
- **时间管理不足**：不支持延期、重新安排等时间调整
- **状态管理简单**：只有"未完成"和"已完成"两种状态
- **协作功能缺失**：无法记录任务相关的讨论和协作信息

### 2.2 用户痛点
- 无法追溯任务完成的具体步骤和方法
- 任务延期时缺乏有效的管理机制
- 复杂任务无法分解和阶段性管理
- 任务相关的资料和笔记分散存储

## 3. 功能设计方案

### 3.1 任务状态扩展

#### 3.1.1 多状态管理
- **未开始** (Not Started)
- **进行中** (In Progress)
- **暂停** (Paused)
- **等待中** (Waiting)
- **已完成** (Completed)
- **已取消** (Cancelled)
- **已延期** (Postponed)

#### 3.1.2 状态转换规则
```
未开始 → 进行中 → 已完成
       ↓         ↓
     已取消   暂停/等待中
       ↑         ↓
     已延期 ← 进行中
```

### 3.2 任务详情编辑功能

#### 3.2.1 基础信息编辑
- **标题修改**：支持任务标题的实时编辑
- **描述更新**：详细描述任务内容和要求
- **优先级调整**：高、中、低优先级设置
- **标签管理**：支持多标签分类

#### 3.2.2 时间管理
- **截止日期调整**：支持延期和提前
- **预估时间**：记录任务预计耗时
- **实际耗时**：自动或手动记录实际完成时间
- **时间日志**：记录每次工作的时间段

#### 3.2.3 进度跟踪
- **完成百分比**：0-100%的进度显示
- **里程碑设置**：关键节点标记
- **子任务分解**：将复杂任务分解为多个子任务
- **依赖关系**：设置任务间的依赖关系

### 3.3 任务执行记录

#### 3.3.1 工作日志
- **日期时间**：自动记录操作时间
- **工作内容**：详细记录当次工作的具体内容
- **遇到问题**：记录执行过程中的困难和解决方案
- **心得体会**：记录经验和教训

#### 3.3.2 附件管理
- **文件上传**：支持相关文档、图片等附件
- **链接收藏**：保存相关的网页链接
- **参考资料**：整理任务相关的学习资料

#### 3.3.3 协作记录
- **讨论记录**：记录与他人的讨论内容
- **反馈收集**：收集他人对任务的反馈意见
- **协作者**：标记参与任务的其他人员

### 3.4 延期管理功能

#### 3.4.1 延期申请
- **延期原因**：必填字段，记录延期的具体原因
- **新截止日期**：设置新的完成时间
- **影响评估**：分析延期对其他任务的影响
- **审批流程**：如需要，支持延期审批机制

#### 3.4.2 延期历史
- **延期次数统计**：记录任务被延期的次数
- **延期时长统计**：计算总延期时间
- **延期原因分析**：帮助用户分析延期模式

### 3.5 任务完成处理

#### 3.5.1 完成确认
- **完成总结**：要求用户填写任务完成总结
- **成果展示**：上传或链接任务成果
- **经验总结**：记录完成任务的经验和方法
- **评分评价**：对任务完成质量进行自评

#### 3.5.2 后续行动
- **相关任务创建**：基于当前任务创建后续任务
- **模板保存**：将任务保存为模板供后续使用
- **知识沉淀**：将任务经验加入个人知识库

## 4. 用户界面设计

### 4.1 任务详情页面
- **顶部状态栏**：显示当前状态和快速操作按钮
- **基础信息区**：标题、描述、时间、优先级等
- **进度跟踪区**：进度条、子任务列表、里程碑
- **工作记录区**：时间轴形式展示工作日志
- **附件资料区**：文件、链接、参考资料管理
- **操作按钮区**：编辑、延期、完成等操作

### 4.2 快速操作
- **状态切换**：一键切换任务状态
- **快速记录**：快速添加工作日志
- **时间追踪**：开始/暂停/结束计时功能
- **进度更新**：快速更新完成百分比

### 4.3 批量操作
- **批量状态更新**：同时更新多个任务状态
- **批量延期**：统一延期多个相关任务
- **批量标签**：为多个任务添加相同标签

## 5. 数据模型设计

### 5.1 任务表 (Tasks)
```sql
CREATE TABLE tasks (
  id INTEGER PRIMARY KEY,
  title TEXT NOT NULL,
  description TEXT,
  status TEXT DEFAULT 'not_started',
  priority INTEGER DEFAULT 2,
  progress INTEGER DEFAULT 0,
  estimated_hours REAL,
  actual_hours REAL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  due_date DATETIME,
  completed_at DATETIME,
  user_id INTEGER,
  parent_task_id INTEGER
);
```

### 5.2 工作日志表 (Work_Logs)
```sql
CREATE TABLE work_logs (
  id INTEGER PRIMARY KEY,
  task_id INTEGER,
  content TEXT NOT NULL,
  work_date DATE,
  start_time DATETIME,
  end_time DATETIME,
  duration_minutes INTEGER,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 5.3 延期记录表 (Postponements)
```sql
CREATE TABLE postponements (
  id INTEGER PRIMARY KEY,
  task_id INTEGER,
  original_due_date DATETIME,
  new_due_date DATETIME,
  reason TEXT NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 5.4 任务附件表 (Task_Attachments)
```sql
CREATE TABLE task_attachments (
  id INTEGER PRIMARY KEY,
  task_id INTEGER,
  file_name TEXT,
  file_path TEXT,
  file_type TEXT,
  file_size INTEGER,
  uploaded_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

## 6. 技术实现要点

### 6.1 状态管理
- 使用状态机模式管理任务状态转换
- 实现状态变更的历史记录
- 提供状态变更的回滚功能

### 6.2 时间追踪
- 实现精确的时间记录功能
- 支持离线时间追踪
- 提供时间统计和分析功能

### 6.3 数据同步
- 实现实时数据同步
- 支持离线编辑和冲突解决
- 提供数据备份和恢复功能

### 6.4 性能优化
- 使用虚拟滚动处理大量任务
- 实现增量加载和懒加载
- 优化数据库查询性能

## 7. 用户体验考虑

### 7.1 易用性
- **渐进式披露**：根据用户需求逐步展示功能
- **智能提醒**：基于用户行为提供智能建议
- **快捷键支持**：提供常用操作的快捷键
- **模板功能**：提供常用任务模板

### 7.2 个性化
- **自定义字段**：允许用户添加自定义属性
- **视图定制**：支持多种任务视图模式
- **通知设置**：个性化的提醒和通知设置
- **主题定制**：支持界面主题个性化

### 7.3 数据洞察
- **完成统计**：任务完成率和效率分析
- **时间分析**：工作时间分布和效率分析
- **延期分析**：延期原因和模式分析
- **生产力报告**：定期生成生产力报告

## 8. 实施计划

### 8.1 第一阶段：基础功能

#### 8.1.1 任务状态扩展
**功能描述：** 将传统的二元状态（未完成/已完成）扩展为多状态管理系统。

**具体实现：**
- **状态定义：**
  - `not_started` - 未开始（默认状态）
  - `in_progress` - 进行中
  - `completed` - 已完成
  - `cancelled` - 已取消
  - `postponed` - 已延期

- **状态转换逻辑：**
  ```typescript
  const statusTransitions = {
    not_started: ['in_progress', 'cancelled', 'postponed'],
    in_progress: ['completed', 'cancelled', 'postponed'],
    completed: [], // 完成状态不可逆转
    cancelled: ['not_started'], // 可重新激活
    postponed: ['not_started', 'in_progress']
  };
  ```

- **UI表现：**
  - 状态标签：使用不同颜色的标签显示当前状态
  - 状态切换：长按任务卡片显示状态切换菜单
  - 状态图标：每种状态对应特定的图标

- **数据库更新：**
  ```sql
  ALTER TABLE tasks ADD COLUMN status TEXT DEFAULT 'not_started';
  ALTER TABLE tasks ADD COLUMN status_changed_at DATETIME;
  
  CREATE TABLE task_status_history (
    id INTEGER PRIMARY KEY,
    task_id INTEGER,
    old_status TEXT,
    new_status TEXT,
    changed_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    reason TEXT
  );
  ```

#### 8.1.2 基础编辑功能
**功能描述：** 提供任务创建后的基础信息编辑能力。

**具体实现：**
- **可编辑字段：**
  - 任务标题（实时编辑）
  - 任务描述（支持多行文本）
  - 截止日期（日期选择器）
  - 优先级（高/中/低）
  - 标签（多选标签）

- **编辑界面设计：**
  - **内联编辑：** 标题支持点击直接编辑
  - **模态编辑：** 复杂字段使用模态窗口编辑
  - **快速编辑：** 提供快速编辑面板

- **编辑权限控制：**
  - 已完成任务限制编辑
  - 编辑历史记录
  - 自动保存机制

- **UI组件：**
  ```typescript
  interface TaskEditProps {
    task: Task;
    onSave: (updatedTask: Task) => void;
    onCancel: () => void;
  }
  
  const TaskEditForm: React.FC<TaskEditProps> = ({ task, onSave, onCancel }) => {
    // 编辑表单实现
  };
  ```

- **数据验证：**
  - 标题不能为空
  - 截止日期不能早于创建日期
  - 优先级必须在有效范围内

#### 8.1.3 简单的工作日志
**功能描述：** 为任务添加简单的工作记录功能，记录执行过程。

**具体实现：**
- **日志结构：**
  ```typescript
  interface WorkLog {
    id: string;
    taskId: string;
    content: string;
    logDate: Date;
    duration?: number; // 可选的工作时长（分钟）
    createdAt: Date;
  }
  ```

- **日志功能：**
  - **快速记录：** 任务详情页提供快速添加日志按钮
  - **时间记录：** 可选择记录工作时长
  - **内容编辑：** 支持文本格式的工作内容记录
  - **日志列表：** 按时间倒序显示所有工作日志

- **UI设计：**
  - **时间轴视图：** 以时间轴形式展示工作日志
  - **快速输入：** 底部固定的快速输入框
  - **日志卡片：** 每条日志以卡片形式展示

- **数据库设计：**
  ```sql
  CREATE TABLE work_logs (
    id INTEGER PRIMARY KEY,
    task_id INTEGER NOT NULL,
    content TEXT NOT NULL,
    log_date DATE NOT NULL,
    duration_minutes INTEGER,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (task_id) REFERENCES tasks(id)
  );
  ```

- **交互设计：**
  - **添加日志：** 点击"+"按钮快速添加
  - **编辑日志：** 长按日志条目进行编辑
  - **删除日志：** 滑动删除或长按菜单删除
  - **时长记录：** 可选的计时器功能

#### 8.1.4 第一阶段技术要点

**状态管理：**
```typescript
// 使用 Zustand 管理任务状态
interface TaskStore {
  tasks: Task[];
  updateTaskStatus: (taskId: string, newStatus: TaskStatus) => void;
  addWorkLog: (taskId: string, log: Omit<WorkLog, 'id' | 'createdAt'>) => void;
  updateTask: (taskId: string, updates: Partial<Task>) => void;
}
```

**组件架构：**
```
TaskDetailScreen
├── TaskHeader (状态、标题)
├── TaskEditForm (编辑表单)
├── TaskStatusChanger (状态切换)
└── WorkLogSection
    ├── WorkLogList (日志列表)
    └── WorkLogInput (快速输入)
```

**数据持久化：**
- 使用 SQLite 本地存储
- 实现自动保存机制
- 提供数据导出功能

**性能优化：**
- 工作日志使用虚拟列表
- 实现增量加载
- 优化数据库查询

### 8.2 第二阶段：进阶功能
- 时间追踪
- 附件管理
- 延期管理

### 8.3 第三阶段：高级功能
- 数据分析
- 智能提醒
- 协作功能

### 8.4 第四阶段：优化完善
- 性能优化
- 用户体验优化
- 功能完善

## 9. 总结

通过实施这套完整的待办事项后续编辑功能，用户将能够：

1. **全面管理任务生命周期**：从创建到完成的全过程管理
2. **详细记录执行过程**：保留任务执行的完整历史
3. **灵活处理时间安排**：支持延期、重新安排等时间管理
4. **积累经验知识**：将任务执行经验转化为可复用的知识
5. **提高工作效率**：通过数据分析优化工作方式

这套功能设计将传统的简单待办事项应用升级为功能完整的任务管理系统，为用户提供更加专业和高效的任务管理体验。